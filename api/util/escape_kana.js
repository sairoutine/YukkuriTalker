var Jaco = require('jaco').default;

var conv_hash = {
	"0" : "ぜろ",
	"1" : "いち",
	"2" : "にい",
	"3" : "さん",
	"4" : "よん",
	"5" : "ご",
	"6" : "ろく",
	"7" : "しち",
	"8" : "はち",
	"9" : "きゅう",
	"a" : "えー",
	"b" : "びー",
	"c" : "しー",
	"d" : "でー",
	"e" : "いー",
	"f" : "えふ",
	"g" : "じー",
	"h" : "えいち",
	"i" : "あい",
	"j" : "じぇい",
	"k" : "けー",
	"l" : "える",
	"m" : "えむ",
	"n" : "えぬ",
	"o" : "おー",
	"p" : "ぴー",
	"q" : "きゅー",
	"r" : "あーる",
	"s" : "えす",
	"t" : "てー",
	"u" : "ゆー",
	"v" : "ぶい",
	"w" : "だぶる",
	"x" : "えっくす",
	"y" : "わい",
	"z" : "ぜっと",
	"〜" : "ー",
	"”" : "",
	"’" : "",
	"゛" : "",
	"゜" : "",
	"ぁ" : "あ",
	"ぃ" : "い",
	"ぅ" : "う",
	"ぇ" : "え",
	"ぉ" : "お",
	"ゎ" : "わ",
	"ヶ" : "け",
	"〃" : "",
	"ゞ" : "",
	"ゝ" : "",
	"ヾ" : "",
	"ヽ" : "",
	"〻" : "",
	"ゐ" : "い",
	"ゑ" : "え",
	"ヴ" : "ぶ",
	"　" : "、",		// 全角スペース
	"・" : "、",
	"…" : "、",
	"!" : "。",
	"@" : "あっとまーく",
	"#" : "しゃーぷ",
	"\\$" : "どる",
	"%" : "ぱーせんと",
	"\\^" : "はっと",
	"&" : "あんど",
	"\\*" : "あすたりすく",
	"\\(" : "かっこ",
	"\\)" : "、",
	"\\[" : "かっこ",
	"\\]" : "、",
	"\\{" : "かっこ",
	"\\}" : "、",
	"「" : "かっこ",
	"」" : "、",
	"\\-" : "はいふん",
	"\\=" : "いこーる",
	"\\+" : "ぷらす",
	"\\|" : "ぱいぷ",
	":" : "ころん",
	";" : "せみころん",
	"\\/" : "すらっしゅ",
	"\\." : "どっと",
	"," : "かんま",
	"<" : "しょうなり",
	">" : "だいなり",
	"\\`" : "ばっくくぉーと",
	"\\~" : "から",
};

module.exports = function(text) {
	var jaco = new Jaco(text);

	jaco
	.toHiragana() // カタカナ→ひらがな
	.combinateSoundMarks() // 濁点を結合
	.toWideJapneseSymbol() // 記号を全角に変換
	._shift(new RegExp('[\uFF01-\uFF5F]', 'g'), -65248) // 全角英数字→半角英数字
	.toLowerCase() // 大文字→小文字
	.replaceMap(conv_hash) // 記号をひらがなへ
	.replace(/[^\u3041-\u3096\u30FC\u3001\u3002\uFF1F]/g, ''); // [ぁ-ゖー。、？]以外削除

	return jaco.toString();
};
